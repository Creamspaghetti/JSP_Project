<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MyMapper">
	<!-- 전체 DB 조회후 productList.jsp에서 표시 -->
	<select id="getAllProducts" resultType="mydto">
		SELECT * FROM Products
	</select>

	<select id="getImage" resultType="mydto">
		SELECT IMAGE_URL FROM PRODUCTS
		p
		WHERE p.PRODUCT_ID = #{Image1}
	</select>

	<!-- 아직 DAO 랑 Action에 로직 추가 안했음 (유저 아이디도 가지고 올 수 있게 만들기) -->
	<select id="getRefunds" resultType="mydto">
		SELECT
		o.ORDERED_NUM,
		o.USER_ID,
		o.PRODUCT_ID,
		o.ordered_date,
		p.Brand,
		p.Product_name,
		p.Price_amount,
		p.Image_url
		FROM
		Ordered o
		JOIN
		Products p ON o.PRODUCT_ID
		=
		p.PRODUCT_ID
		WHERE
		o.USER_ID = #{userid}
	</select>

	<!-- 주문 내역 -->
	<select id="getOrdered" resultType="mydto">
		SELECT
		o.ORDERED_NUM,
		o.USER_ID,
		o.PRODUCT_ID,
		o.ordered_date,
		p.Brand,
		p.Product_name,
		p.Price_amount,
		p.Image_url
		FROM
		Ordered o
		JOIN
		Products p ON o.PRODUCT_ID
		=
		p.PRODUCT_ID
		WHERE
		o.USER_ID = #{userid}
	</select>

	<!-- 회원 삭제 -->
	<!-- Ordered 테이블에서 USER_ID가 #{userid}인 데이터 삭제 -->
	<delete id="deleteFromOrdered">
		DELETE FROM Ordered WHERE USER_ID = #{userid}
	</delete>

	<!-- Cart 테이블에서 USER_ID가 #{userid}인 데이터 삭제 -->
	<delete id="deleteFromCart">
		DELETE FROM Cart WHERE USER_ID = #{userid}
	</delete>

	<!-- Users 테이블에서 USER_ID가 #{userid}인 데이터 삭제 -->
	<delete id="deleteFromUsers">
		DELETE FROM Users WHERE USER_ID = #{userid}
	</delete>

	<update id="finishedRefund" resultType="mydto">
		UPDATE ORDERED
		SET product_id = '환불 완료'
		WHERE USER_ID = #{userid}
	</update>

</mapper>
